# Animation Contract

This document specifies the **Animation Contract** between the **Framer** and the **Renderer** modules.  
It ensures that any renderer can visualize an animation generated by the framer, independent of the underlying rendering technology (LaTeX/TikZ, Angular, WebGL, etc.).

---

## 1. Core Concepts

### 1.1 Animation
```ts
export type Animation = Frame[];
```
- An **Animation** is a sequence of `Frame` objects.
- Each `Frame` represents one snapshot of the algorithm’s execution.

---

### 1.2 Frame
```ts
export type Frame = FrameState[];
```
- A **Frame** is a collection of `FrameState` objects.
- Each `FrameState` corresponds to the state of one abstraction (e.g., array, graph, chart, log).

---

### 1.3 FrameState
```ts
export type FrameState<T = unknown> = {
  id: string;
  type: string;
  state: T;
}
```
- Represents the **state of a single abstraction** at a given time.
- **Fields:**
    - `id`: Unique identifier of the abstraction (e.g., `"array1"`, `"graph-main"`).
    - `type`: Type of abstraction (`"array2d"`, `"graph"`, `"chart"`, `"log"`).
    - `state`: Type-specific state object (see below).

---

## 2. Supported Abstraction States

Each abstraction type has its own state structure.  
Renderers must support the following `state` schemas:

### 2.1 Log
```ts
export type LogState = {
  name: string;
  message: string;
};
```

### 2.2 Graph
```ts
export type GraphState = {
  name: string;
  nodes: GraphNodeState[];
  edges: GraphEdgeState[];
  isDirected: boolean;
};
```

#### GraphNodeState
```ts
export type GraphNodeState = {
  id: string;
  label: string;
  highlightTags: string[];
};
```

#### GraphEdgeState
```ts
export type GraphEdgeState = {
  id: string;
  source: string;
  target: string;
  label: string;
  highlightTags: string[];
};
```

---

### 2.3 Chart
```ts
export type ChartState = {
  name: string;
  bars: ChartBarState[];
};
```

#### ChartBarState
```ts
export type ChartBarState = {
  value: number;
  label: string;
  highlightTags: string[];
};
```

---

### 2.4 Array2D
```ts
export type Array2dState = {
  name: string;
  values: Array2dCellState[][];
};
```

#### Array2dCellState
```ts
export type Array2dCellState = {
  value: string;
  highlightTags: string[];
};
```

---

## 3. Renderer Responsibilities

1. **Parse Animation**
    - Receive an `Animation` object.
    - Iterate through frames in sequence.

2. **Render Frames**
    - For each frame, draw all contained `FrameState` objects.
    - Dispatch each `FrameState` to a **type-specific renderer**.

3. **Type-specific Rendering**
    - Implement rendering logic for each abstraction type:
        - `array2d` → grid/LaTeX matrix/table/HTML table
        - `chart` → bar chart
        - `graph` → node-edge diagram
        - `log` → textual log/messages

---

## 4. Benefits

- **Extensibility**: Adding a new renderer requires only interpreting the contract.
- **Portability**: The same animation can be rendered in LaTeX, Angular, Console, etc.
- **Consistency**: All renderers receive identical data from the framer.

---
